{"version":3,"sources":["../../src/animate/Timeline.js"],"names":["Timeline","target","Array","call","_currentProps","p","prototype","Object","create","addTween","properties","startFrame","duration","ease","extendLastFrame","startProps","prop","hasOwnProperty","startValue","getPropFromShorthand","i","length","endProps","tween","Tween","push","assign","addKeyframe","endFrame","prevTween","isTweenlessFrame","position","x","y","scale","skew","rotation","alpha","visible","mask"],"mappings":"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","file":"Timeline.js","sourcesContent":["import Tween from './Tween';\r\n\r\n/**\r\n * The Timeline class represents a\r\n * @memberof PIXI.animate\r\n * @class Timeline\r\n * @param {PIXI.DisplayObject} Target The target for this string of tweens.\r\n * @extends Array\r\n * @constructor\r\n */\r\nconst Timeline = function(target) {\r\n    Array.call(this);\r\n\r\n    /**\r\n     * The target DisplayObject.\r\n     * @name PIXI.animate.Timeline#target\r\n     * @type {PIXI.DisplayObject}\r\n     */\r\n    this.target = target;\r\n\r\n    /**\r\n     * Current properties in the tween, to make building the timeline more\r\n     * efficient.\r\n     * @name PIXI.animate.Timeline#_currentProps\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    this._currentProps = {};\r\n};\r\n\r\nconst p = Timeline.prototype = Object.create(Array.prototype);\r\n\r\n/**\r\n * Adds one or more tweens (or timelines) to this timeline. The tweens will be paused (to remove them from the normal ticking system)\r\n * and managed by this timeline. Adding a tween to multiple timelines will result in unexpected behaviour.\r\n * @method PIXI.animate.Timeline#addTween\r\n * @param tween The tween(s) to add. Accepts multiple arguments.\r\n * @return Tween The first tween that was passed in.\r\n */\r\np.addTween = function(properties, startFrame, duration, ease) {\r\n    this.extendLastFrame(startFrame - 1);\r\n    //ownership of startProps is passed to the new Tween - this object should not be reused\r\n    let startProps = {};\r\n    let prop;\r\n    //figure out what the starting values for this tween should be\r\n    for (prop in properties) {\r\n        //if we have already set that property in an earlier tween, use the ending value\r\n        if (this._currentProps.hasOwnProperty(prop)) {\r\n            startProps[prop] = this._currentProps[prop];\r\n        }\r\n        //otherwise, get the current value\r\n        else {\r\n            let startValue = startProps[prop] = this.getPropFromShorthand(prop);\r\n            //go through previous tweens to set the value so that when the timeline loops\r\n            //around, the values are set properly - having each tween know what came before\r\n            //allows us to set to a specific frame without running through the entire timeline\r\n            for (let i = this.length - 1; i >= 0; --i) {\r\n                this[i].startProps[prop] = startValue;\r\n                this[i].endProps[prop] = startValue;\r\n            }\r\n        }\r\n    }\r\n    //create the new Tween and add it to the list\r\n    let tween = new Tween(this.target, startProps, properties, startFrame, duration, ease);\r\n    this.push(tween);\r\n    //update starting values for the next tween - if tweened values included 'p', then Tween\r\n    //parsed that to add additional data that is required\r\n    Object.assign(this._currentProps, tween.endProps);\r\n};\r\n\r\n/**\r\n * Add a single keyframe that doesn't tween.\r\n * @method PIXI.animate.Timeline#addKeyframe\r\n * @param {Object} properties The properties to set.\r\n * @param {int} startFrame The starting frame index.\r\n */\r\np.addKeyframe = function(properties, startFrame) {\r\n    this.extendLastFrame(startFrame - 1);\r\n    let startProps = Object.assign({}, this._currentProps, properties);\r\n    //create the new Tween and add it to the list\r\n    let tween = new Tween(this.target, startProps, null, startFrame, 0);\r\n    this.push(tween);\r\n    Object.assign(this._currentProps, tween.endProps);\r\n};\r\n\r\n/**\r\n * Extend the last frame of the tween.\r\n * @method PIXI.animate.Timeline#extendLastFrame\r\n * @param {int} endFrame The ending frame index.\r\n */\r\np.extendLastFrame = function(endFrame) {\r\n    if (this.length) {\r\n        let prevTween = this[this.length - 1];\r\n        if (prevTween.endFrame < endFrame) {\r\n            if (prevTween.isTweenlessFrame) {\r\n                prevTween.endFrame = endFrame;\r\n            } else {\r\n                this.addKeyframe(\r\n                    this._currentProps,\r\n                    prevTween.endFrame + 1,\r\n                    endFrame - prevTween.endFrame + 1\r\n                );\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Get the value for a property\r\n * @method PIXI.animate.Timeline#getPropFromShorthand\r\n * @param {string} prop\r\n */\r\np.getPropFromShorthand = function(prop) {\r\n    const target = this.target;\r\n    switch (prop) {\r\n        case 'x':\r\n            return target.position.x;\r\n        case 'y':\r\n            return target.position.y;\r\n        case 'sx':\r\n            return target.scale.x;\r\n        case 'sy':\r\n            return target.scale.y;\r\n        case 'kx':\r\n            return target.skew.x;\r\n        case 'ky':\r\n            return target.skew.y;\r\n        case 'r':\r\n            return target.rotation;\r\n        case 'a':\r\n            return target.alpha;\r\n        case 'v':\r\n            return target.visible;\r\n        case 'm':\r\n            return target.mask;\r\n            // case 't':\r\n            //   return target.tint;\r\n            //not sure if we'll actually handle graphics this way?\r\n            //g: return null;\r\n    }\r\n    return null;\r\n};\r\n\r\n// Assign to namespace\r\nexport default Timeline;"]}